- name: Run Fetch Script
        run: |
          python -c "
          import requests, json, time
          # 定義要抓取的清單
          stocks = ['2330', '0050', '006208', 'TAIEX']
          result = {}

          for s in stocks:
              print(f'正在抓取 {s}...')
              # FinMind API
              url = f'https://api.finmindtrade.com/api/v4/data?dataset=TaiwanStockPrice&data_id={s}&start_date=2016-01-01'
              try:
                  r = requests.get(url)
                  raw_data = r.json().get('data', [])
                  
                  if not raw_data:
                      print(f'警告：{s} 沒有回傳資料')
                      continue

                  # 統一轉換欄位名稱，相容個股與大盤
                  formatted = []
                  for d in raw_data:
                      formatted.append({
                          't': d.get('date'),
                          'o': d.get('open') or d.get('開盤價'),
                          'h': d.get('max') or d.get('最高價'),
                          'l': d.get('min') or d.get('最低價'),
                          'c': d.get('close') or d.get('收盤價')
                      })
                  result[s] = formatted
                  time.sleep(1) # 稍微停頓，避免被 API 擋掉
              except Exception as e:
                  print(f'抓取 {s} 時發生錯誤: {e}')

          with open('data.json', 'w', encoding='utf-8') as f:
              json.dump(result, f, ensure_ascii=False)
          print('資料成功寫入 data.json')
          "
